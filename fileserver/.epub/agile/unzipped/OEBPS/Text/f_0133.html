<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Agile Web Development with Rails</title>
  <link href="../Styles/bookshelf.css" rel="stylesheet" type="text/css" />
  <link href="../Styles/book_local.css" rel="stylesheet" type="text/css" />
  <link href="../Styles/page-template.xpgt" rel="stylesheet" type="application/vnd.adobe-page-template+xml" />
  <meta content="rails4" name="bookcode" />
  <style type="text/css">
/*<![CDATA[*/

  code.sgc-1 {white-space: pre-wrap;}
  /*]]>*/
  </style>
</head>

<body>
  <h2 id="sec.active.support">24.2 A Library Function Using Active Support</h2>

  <p id="N1EA9B">Active Support is a set of libraries shared by all Rails components. Some of what’s in there is intended for Rails’ internal use; however, all of it is available for use by non-Rails applications.</p>

  <p id="N1EAA9">This could be important if you develop a Rails application and in the course of that development you produce a set of classes or even just a set of methods that you would like to make use of in a non-Rails application. You start by copying and pasting this code into a separate file and then find out that it doesn’t run&mdash;not because this logic is dependent on your application in any way but because it makes use of other methods and classes that Rails provides.</p>

  <p id="N1EAAC">We will start with a brief survey of some of the most important of these and along the way show how they can be made available to your application.</p>

  <h3 id="heading_id_2">Core Extensions (core-ext)</h3>

  <p id="N1EAB3">Active Support extends some of Ruby’s built-in classes in interesting, useful, and sometimes whimsical ways. In this section, we’ll quickly list the most popular of these core extensions.</p>

  <ul>
    <li>
      <p id="N1EABF"><span class="emph">Array</span>: <code class="cf methodname">second</code>, <code class="cf methodname">third</code>, <code class="cf methodname">fourth</code>, <code class="cf methodname">fifth</code> and <code class="cf methodname">forty_two</code>. These complement the <code class="cf methodname">first</code> and <code class="cf methodname">last</code> methods provided by Ruby itself.</p>
    </li>

    <li>
      <p id="N1EADA"><span class="emph">CGI</span>: <code class="cf methodname">escape_skipping_slashes</code>. As the name implies, it differs from <code class="cf methodname">escape</code> in that it doesn’t escape slashes.</p>
    </li>

    <li>
      <p id="N1EAE6"><span class="emph">Class</span>: Accessors for class attributes, delegating accessors, inheritable readers and writers, and descendants (aka subclasses). These methods are too numerous to enumerate; see the documentation for details.</p>
    </li>

    <li>
      <p id="N1EAEC"><span class="emph">Date</span>: <code class="cf methodname">yesterday</code>, <code class="cf methodname">future?</code>, <code class="cf methodname">next_month</code>, and many, many more.</p>
    </li>

    <li>
      <p id="N1EAFB"><span class="emph">Enumerable</span>: <code class="cf methodname">group_by</code>, <code class="cf methodname">sum</code>, <code class="cf methodname">each_with_object</code>, <code class="cf methodname">index_by</code>, <code class="cf methodname">many?</code>, and <code class="cf methodname">exclude?</code>.</p>
    </li>

    <li>
      <p id="N1EB13"><span class="emph">File</span>: <code class="cf methodname">atomic_write</code>, and <code class="cf methodname">path</code>.</p>
    </li>

    <li>
      <p id="N1EB1F"><span class="emph">Float</span>: Adds an optional <code class="cf ic">precision</code> argument to <code class="cf methodname">round</code>.</p>
    </li>

    <li>
      <p id="N1EB2B"><span class="emph">Hash</span>: <code class="cf methodname">diff</code>, <code class="cf methodname">deep_merge</code>, <code class="cf methodname">except</code>, <code class="cf methodname">stringify_keys</code>, <code class="cf methodname">symbolize_keys</code>, <code class="cf methodname">reverse_merge</code>, and <code class="cf methodname">slice</code>. Many of these methods also have variants ending in a exclamation point.</p>
    </li>

    <li>
      <p id="N1EB46"><span class="emph">Integer</span>: <code class="cf methodname">ordinalize</code>, <code class="cf methodname">multiple_of?</code>. <code class="cf methodname">months</code>, <code class="cf methodname">years</code>. See also <span class="emph">Numeric</span>.</p>
    </li>

    <li>
      <p id="N1EB5B"><span class="emph">Kernel</span>: <code class="cf methodname">debugger</code>, <code class="cf methodname">breakpoint</code>. <code class="cf methodname">silence_warnings</code>, <code class="cf methodname">enable_warnings</code>.</p>
    </li>

    <li>
      <p id="N1EB6D"><span class="emph">Module</span>: Accessors for module attributes, aliasing support, delegation, deprecation, internal readers and writers, synchronization, and parentage.</p>
    </li>

    <li>
      <p id="N1EB73"><span class="emph">Numeric</span>: <code class="cf methodname">bytes</code>, <code class="cf methodname">kilobytes</code>, <code class="cf methodname">megabytes</code>, and so on; <code class="cf methodname">seconds</code>, <code class="cf methodname">minutes</code>, <code class="cf methodname">hours</code>, and so on.</p>
    </li>

    <li>
      <p id="N1EB8B"><span class="emph">Object</span>: <code class="cf methodname">blank?</code>, <code class="cf methodname">present?</code>, <code class="cf methodname">duplicable?</code>, <code class="cf methodname">instance_values</code>, <code class="cf methodname">instance_variable_</code> <code class="cf methodname">names</code>, <code class="cf methodname">returning</code>, and <code class="cf methodname">try</code>.</p>
    </li>

    <li>
      <p id="N1EBA8"><span class="emph">String</span>: <code class="cf methodname">exclude?</code>, <code class="cf methodname">pluralize</code>, <code class="cf methodname">singularize</code>, <code class="cf methodname">camelize</code>, <code class="cf methodname">titleize</code>, <code class="cf methodname">underscore</code>, <code class="cf methodname">dasherize</code>, <code class="cf methodname">demodulize</code>, <code class="cf methodname">parameterize</code>, <code class="cf methodname">tableize</code>, <code class="cf methodname">classify</code>, <code class="cf methodname">humanize</code>, <code class="cf methodname">foreign_key</code>, <code class="cf methodname">constantize</code>, <code class="cf methodname">squish</code>, <code class="cf methodname">mb_chars</code>, <code class="cf methodname">at?</code>, <code class="cf methodname">from</code>, <code class="cf methodname">to</code>, <code class="cf methodname">first</code>, <code class="cf methodname">last</code>, <code class="cf methodname">to_time</code>, <code class="cf methodname">to_date</code>, and <code class="cf methodname">try</code>.</p>
    </li>

    <li>
      <p id="N1EBF6"><span class="emph">Time</span>: <code class="cf methodname">yesterday</code>, <code class="cf methodname">future?</code>, <code class="cf methodname">advance</code>, and many, many more.</p>
    </li>
  </ul>

  <p id="N1EC04">As you can see, this is a fairly long list. These methods tend to be fairly small; many are only a single line of code. Although you will probably only ever use a small percentage of these, all of them are available for use in your Rails application.</p>

  <div class="xxxsays">
    <div class="heading">
      <div class="persons-picture"><img alt="David says:" src="../Images/David.png" /></div>

      <div class="label">
        David says:
      </div>

      <div class="title">
        Why Extending Base Classes Doesn’t Lead to the Apocalypse
      </div>
    </div>

    <div class="body">
      <p id="N1EC0B">The awe that seeing <code class="cf ic">5.months + 30.minutes</code> for the first time is usually replaced by a state of panic shortly thereafter. If everyone can just change how integers work, won’t that lead to an utterly unmaintainable spaghetti land of hell? Yes, if everyone did that all the time, it would. But they don’t, so it doesn’t.</p>

      <p id="N1EC11">Don’t think of Active Support as a collection of random extensions to the Ruby language that invites everyone and their brother to add their own pet feature to the string class. Think of it as a dialect of Ruby spoken universally by all Rails programmers. Because Active Support is a required part of Rails, you can always rely on that <code class="cf ic">5.months</code> will work in any Rails application. That negates the problem of having a thousand personal dialects of Ruby.</p>

      <p id="N1EC17">Active Support gives us the best of both worlds when it comes to language extensions. It’s contextual standardization.</p>
    </div>
  </div>

  <p id="N1EC1A">As you can also see, there is a lot there. Most of it you won’t ever directly use. However, you’ll quickly find yourself adopting a small portion of these additional methods as if they were part of the Ruby language itself. Although all of these methods are documented online,<a href="../Text/f_0134.html#FOOTNOTE-54" id="FNPTR-54">[54]</a> the best way to learn is often to experiment directly by using <code class="cf commandname">rails console</code>. Here are a few things to try:</p>

  <ul>
    <li>
      <p id="N1EC29"><code class="cf ic">2.years.ago</code></p>
    </li>

    <li>
      <p id="N1EC2E"><code class="cf ic">[1,2,3,4].sum</code></p>
    </li>

    <li>
      <p id="N1EC33"><code class="cf ic">5.gigabytes</code></p>
    </li>

    <li>
      <p id="N1EC38"><code class="cf ic">"man".pluralize</code></p>
    </li>

    <li>
      <p id="N1EC3D"><code class="cf ic">String.methods.sort</code></p>
    </li>
  </ul>

  <p id="N1EC41">Because there is no one best way to identify what subset works for you, simply be aware that these methods exist and check the documentation when you find yourself with what seems to be a common need because the Rails developers may have already added the method that you find missing.</p>

  <h3 id="heading_id_3">Additional Active Support Classes</h3>

  <p id="N1EC4F">In addition to extending the base objects provided by Ruby, Active Support provides plenty of additional functionality. More so than with the core extensions, these classes tend to support specific needs of other Rails components, but you are welcome to make use of these functions directly.</p>

  <ul>
    <li>
      <p id="N1EC55"><span class="emph">BasicObject</span>: A backport of Ruby 1.9’s class of the same name to Ruby 1.8.</p>
    </li>

    <li>
      <p id="N1EC5B"><span class="emph">Benchmarkable</span>: Measures the execution time of a block in a template and records the results to the log.</p>
    </li>

    <li>
      <p id="N1EC61"><span class="emph">Cache::Store</span>: Various implementations of caches, based on files or memory; with synchronized or compressed as options.</p>
    </li>

    <li>
      <p id="N1EC67"><span class="emph">Callbacks</span>: Provide hooks into the life cycle of an object.</p>
    </li>

    <li>
      <p id="N1EC6D"><span class="emph">Concern</span> and <span class="emph">Dependencies</span>: Helps manage dependencies in a modular way.</p>
    </li>

    <li>
      <p id="N1EC76"><span class="emph">Configurable</span>: Provides a config <code class="cf ic">Hash</code> class variable.</p>
    </li>

    <li>
      <p id="N1EC7F"><span class="emph">Deprecation</span>: Provides behavior, reporting, and wrapping to support deprecation of methods.</p>
    </li>

    <li>
      <p id="N1EC85"><span class="emph">Duration</span>: Additional methods such as <code class="cf methodname">ago</code> and <code class="cf methodname">since</code>.</p>
    </li>

    <li>
      <p id="N1EC91"><span class="emph">Gzip</span>: Convenience methods to <code class="cf methodname">compress</code> and <code class="cf methodname">decompress</code> a String.</p>
    </li>

    <li>
      <p id="N1EC9D"><span class="emph">HashWithIndifferentAccess</span>: Allows both <code class="cf ic">params[:key]</code> and <code class="cf ic">params[’key’]</code>.</p>
    </li>

    <li>
      <p id="N1ECA9"><span class="emph">I18n</span>: Internationalization support.</p>
    </li>

    <li>
      <p id="N1ECAF"><span class="emph">Inflections</span>: Handles English’s inconsistent rules for pluralization.</p>
    </li>

    <li>
      <p id="N1ECB5"><span class="emph">JSON</span>: JavaScript Object Notation encoding and decoding methods.</p>
    </li>

    <li>
      <p id="N1ECC1"><span class="emph">LazyLoadHooks</span>: Support for deferred initialization of modules.</p>
    </li>

    <li>
      <p id="N1ECC7"><span class="emph">Memoizable</span>: Caches the result of a method call.</p>
    </li>

    <li>
      <p id="N1ECCD"><span class="emph">MessageEncryptor</span>: Encrypts values that are to be stored someplace untrustworthy.</p>
    </li>

    <li>
      <p id="N1ECD3"><span class="emph">MessageVerifier</span>: Generates and verifies signed messages (prevents tampering).</p>
    </li>

    <li>
      <p id="N1ECD9"><span class="emph">MultiByte</span>: Encoding support (primarily for Ruby 1.8.7).</p>
    </li>

    <li>
      <p id="N1ECDF"><span class="emph">Notifications</span>: Instrumentation API.</p>
    </li>

    <li>
      <p id="N1ECE5"><span class="emph">OptionMerger</span>: Deep merge lambda expressions.</p>
    </li>

    <li>
      <p id="N1ECEB"><span class="emph">OrderedHash</span> and <span class="emph">OrderedOptions</span>: Provides ordered hash support (primarily for Ruby 1.8.7).</p>
    </li>

    <li>
      <p id="N1ECF4"><span class="emph">Railtie</span>: Defines core objects that the rest of the framework can depend on.</p>
    </li>

    <li>
      <p id="N1ECFA"><span class="emph">Rescueable</span>: Eases exception handling.</p>
    </li>

    <li>
      <p id="N1ED00"><span class="emph">SecureRandom</span>: Generates random numbers suitable for generating session keys in HTTP cookies.</p>
    </li>

    <li>
      <p id="N1ED0F"><span class="emph">StringInquirer</span>: Provides a prettier way to test for equality.</p>
    </li>

    <li>
      <p id="N1ED15"><span class="emph">TestCase</span>: Testing framework independent interface to test cases.</p>
    </li>

    <li>
      <p id="N1ED1B"><span class="emph">Time</span> and <span class="emph">TimeWithZone</span>: Even more support for time calculations and conversions.</p>
    </li>
  </ul>

  <p id="N1ED29">So although this book will not go into the (currently) forty-nine methods and counting that, for example, <code class="cf ic">TimeWithZone</code> alone provides, the previous list will enable you to find the functions you need in the guides and API documentation. But what this book will do is show you how you can use these methods in your stand-alone application:</p>

  <table class="processedcode">
    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">require <em class="string">"rubygems"</em></code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">require <em class="string">"active_support/time"</em></code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">Time.zone = <em class="string">'Eastern Time (US &amp; Canada)'</em></code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">puts Time.zone.now</code></td>
    </tr>
  </table>

  <p id="N1ED49">So if, like most people, you find yourself addicted to one or more of these extensions, you can simply require what you need (for example, <code class="cf ic">require "active_</code> <code class="cf ic">support/basic_object"</code> or <code class="cf ic">require "active_support/core_ext"</code>) or pull in everything with <code class="cf ic">require "active_support/all"</code>.</p>

  <h3 id="heading_id_4">Using Action View Helpers</h3>

  <p id="N1ED65">OK, so although this doesn’t exactly fall under the category of Active Support, it is close enough. What applies to Active Support also applies to other parts of Rails, though most routing, controllers, and Action View methods tend to be relevant only to the processing of an active web request.</p>

  <p id="N1ED68">One notable exception is some of the Action View helpers. Here’s an example of how you can access an Action View helper from a stand-alone application:</p>

  <table class="processedcode">
    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">require <em class="string">"rubygems"</em></code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">require <em class="string">"action_view"</em></code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">require <em class="string">"action_view/helpers"</em></code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">include ActionView::Helpers::DateHelper</code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">puts distance_of_time_in_words_to_now(Time.parse(<em class="string">"December 25"</em>))</code></td>
    </tr>
  </table>

  <p id="N1ED91">All in all, this is only slightly more work than getting access to the much more commonly needed Active Support methods, but it’s still quite doable.</p>

  <p id="N1ED94">At this point, we’ve covered accessing some or all of Rails functionality from scripts running on the same machine as the server; now let’s move on to accessing your Rails application remotely.</p><script src="../Misc/book_local.js" type="text/javascript">
</script>
</body>
</html>
