<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Agile Web Development with Rails</title>
  <link href="../Styles/bookshelf.css" rel="stylesheet" type="text/css" />
  <link href="../Styles/book_local.css" rel="stylesheet" type="text/css" />
  <link href="../Styles/page-template.xpgt" rel="stylesheet" type="application/vnd.adobe-page-template+xml" />
  <meta content="rails4" name="bookcode" />
  <style type="text/css">
/*<![CDATA[*/

  code.sgc-1 {white-space: pre-wrap;}
  /*]]>*/
  </style>
</head>

<body>
  <h2 id="heading_id_2">21.3 Processing Forms</h2>

  <table class="figure" id="fig.mvc.integration">
    <tr>
      <td><img alt="images/mvc_integration.png" src="../Images/mvc_integration.png" xmlns:str="http://exslt.org/strings" /></td>
    </tr>

    <tr>
      <td align="center">
        <hr />
        <b>Figure 49. Models, controllers, and views work together.</b>
      </td>
    </tr>
  </table>

  <p id="N1C5EA">In Figure 49, <a href="#fig.mvc.integration">​<em>Models, controllers, and views work together.</em>​</a>, we can see how the various attributes in the model pass through the controller to the view, on to the HTML page, and back again into the model. The model object has attributes such as <code class="cf variable">name</code>, <code class="cf variable">country</code>, and <code class="cf variable">password</code>. The template uses helper methods to construct an HTML form to let the user edit the data in the model. Note how the form fields are named. The <code class="cf variable">country</code> attribute, for example, maps to an HTML input field with the name <code class="cf ic">user[country]</code>.</p>

  <p id="N1C605">When the user submits the form, the raw POST data is sent back to our application. Rails extracts the fields from the form and constructs the <code class="cf variable">params</code> hash. Simple values (such as the id field, extracted by routing from the form action) are stored directly in the hash. But, if a parameter name has brackets in it, Rails assumes that it is part of more structured data and constructs a hash to hold the values. Inside this hash, the string inside the brackets acts as the key. This process can repeat if a parameter name has multiple sets of brackets in it.</p>

  <table class="simpletable">
    <thead>
      <tr>
        <th>
          <p class="last-para-in-cell">Form parameters</p>
        </th>

        <th>
          <p class="last-para-in-cell"><code class="cf variable">params</code></p>
        </th>
      </tr>
    </thead>

    <tbody>
      <tr class="tr">
        <td>
          <p class="last-para-in-cell"><code class="cf ic">id=123</code></p>
        </td>

        <td>
          <p class="last-para-in-cell"><code class="cf ic">{ id: "123" }</code></p>
        </td>
      </tr>

      <tr class="tr">
        <td>
          <p class="last-para-in-cell"><code class="cf ic">user[name]=Dave</code></p>
        </td>

        <td>
          <p class="last-para-in-cell"><code class="cf ic">{ user: { name: "Dave" }}</code></p>
        </td>
      </tr>

      <tr class="tr">
        <td>
          <p class="last-para-in-cell"><code class="cf ic">user[address][city]=Wien</code></p>
        </td>

        <td>
          <p class="last-para-in-cell"><code class="cf ic">{ user: { address: { city: "Wien" }}}</code></p>
        </td>
      </tr>
    </tbody>
  </table>

  <p id="N1C653">In the final part of the integrated whole, model objects can accept new attribute values from hashes, which allows us to say this:</p>

  <table class="processedcode">
    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">user.update_attributes(params[:user])</code></td>
    </tr>
  </table>

  <p id="N1C661">Rails integration goes deeper than this. Looking at the <code class="cf fileextension">html.erb</code> file in <a href="#fig.mvc.integration"></a>, we can see that the template uses a set of helper methods to create the form’s HTML; these are methods such as <code class="cf methodname">form_for</code> and <code class="cf methodname">text_field</code>.</p>

  <p id="N1C676">Before moving on, it is worth noting that <code class="cf ic">params</code> may be used for more than simple text. Entire files can be uploaded. We’ll cover that next.</p><script src="../Misc/book_local.js" type="text/javascript">
</script>
</body>
</html>
