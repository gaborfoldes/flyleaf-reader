<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Agile Web Development with Rails</title>
  <link href="../Styles/bookshelf.css" rel="stylesheet" type="text/css" />
  <link href="../Styles/book_local.css" rel="stylesheet" type="text/css" />
  <link href="../Styles/page-template.xpgt" rel="stylesheet" type="application/vnd.adobe-page-template+xml" />
  <meta content="rails4" name="bookcode" />
  <style type="text/css">
/*<![CDATA[*/

  code.sgc-1 {white-space: pre-wrap;}
  /*]]>*/
  </style>
</head>

<body>
  <h2 id="heading_id_2">4.3 Logic</h2>

  <p id="N11499">Method calls are statements. Ruby also provides a number of ways to make decisions that affect the repetition and order in which methods are invoked.</p>

  <h3 id="heading_id_3">Control Structures</h3>

  <p id="N114A0">Ruby has all the usual control structures, such as <code class="cf ic">if</code> statements and <code class="cf ic">while</code> loops. Java, C, and Perl programmers may well get caught by the lack of braces around the bodies of these statements. Instead, Ruby uses the keyword <code class="cf ic">end</code> to signify the end of a body:</p>

  <table class="processedcode">
    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1"><strong class="prompt">if</strong> count &gt; 10</code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">puts <em class="string">"Try again"</em></code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1"><strong class="prompt">elsif</strong> tries == 3</code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">puts <em class="string">"You lose"</em></code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1"><strong class="prompt">else</strong></code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">puts <em class="string">"Enter a number"</em></code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1"><strong class="prompt">end</strong></code></td>
    </tr>
  </table>

  <p id="N114E4">Similarly, <code class="cf ic">while</code> statements are terminated with <code class="cf ic">end</code>:</p>

  <table class="processedcode">
    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1"><strong class="prompt">while</strong> weight &lt; 100 <strong class="prompt">and</strong> num_pallets &lt;= 30</code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">pallet = next_pallet()</code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">weight += pallet.weight</code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">num_pallets += 1</code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1"><strong class="prompt">end</strong></code></td>
    </tr>
  </table>

  <p id="N11511">Ruby also contains variants of these statements: <code class="cf ic">unless</code> is like <code class="cf ic">if</code> except that it checks for the condition to <span class="emph">not</span> be true. Similarly, <code class="cf ic">until</code> is like <code class="cf ic">while</code> except that the loop continues until the condition evaluates to be true.</p>

  <p id="N11538">Ruby <span class="firstuseinline">statement</span> modifiers are a useful shortcut if the body of an <code class="cf ic">if</code>, <code class="cf ic">unless</code>, <code class="cf ic">while</code>, or <code class="cf ic">until</code> statement is just a single expression. Simply write the expression, followed by the modifier keyword and the condition:</p>

  <table class="processedcode">
    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">puts <em class="string">"Danger, Will Robinson"</em> <strong class="prompt">if</strong> radiation &gt; 3000</code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">distance = distance * 1.2 <strong class="prompt">while</strong> distance &lt; 100</code></td>
    </tr>
  </table>

  <p id="N1156A">Although <code class="cf ic">if</code> statements are fairly common in Ruby applications, newcomers to the Ruby language are often surprised to find that looping constructs are rarely used. Blocks and iterators often take their place.</p>

  <h3 id="wtf.iterating">Blocks and Iterators</h3>

  <p id="N11575">Code blocks are just chunks of code between braces or between <code class="cf ic">do</code>â€¦<code class="cf ic">end</code>. A common convention is that people use braces for single-line blocks and <code class="cf ic">do</code>/<code class="cf ic">end</code> for multiline blocks:</p>

  <table class="processedcode">
    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">{ puts <em class="string">"Hello"</em> } <em class="comment"># this is a block</em></code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1"><strong class="prompt">do</strong> <em class="comment">###</em></code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">club.enroll(person) <em class="comment"># and so is this</em></code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">person.socialize <em class="comment">#</em></code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1"><strong class="prompt">end</strong> <em class="comment">###</em></code></td>
    </tr>
  </table>

  <p id="N115BD">To pass a block to a method, place the block after the parameters (if any) to the method. In other words, put the start of the block at the end of the source line containing the method call. For example, in the following code, the block containing <code class="cf ic">puts&nbsp;"Hi"</code> is associated with the call to the method <code class="cf methodname">greet</code>:</p>

  <table class="processedcode">
    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">greet { puts <em class="string">"Hi"</em> }</code></td>
    </tr>
  </table>

  <p id="N115D4">If a method call has parameters, they appear before the block:</p>

  <table class="processedcode">
    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">verbose_greet(<em class="string">"Dave"</em>, <em class="string">"loyal customer"</em>) { puts <em class="string">"Hi"</em> }</code></td>
    </tr>
  </table>

  <p id="wtf.yield">A method can invoke an associated block one or more times using the Ruby <code class="cf ic">yield</code> statement. You can think of <code class="cf ic">yield</code> as being something like a method call that calls out to the block associated with the method containing the <code class="cf ic">yield</code>. You can pass values to the block by giving parameters to <code class="cf ic">yield</code>. Within the block, you list the names of the arguments to receive these parameters between vertical bars (<code class="cf ic">|</code>).</p>

  <p id="N1160D">Code blocks appear throughout Ruby applications. Often they are used in conjunction with iterators: methods that return successive elements from some kind of collection, such as an array:</p>

  <table class="processedcode">
    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">animals = <em class="string">%w( ant bee cat dog elk )</em> <em class="comment"># create an array</em></code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">animals.each {|animal| puts animal } <em class="comment"># iterate over the contents</em></code></td>
    </tr>
  </table>

  <p id="wtf.3.times">Each integer <span class="emph">N</span> implements a <code class="cf methodname">times</code> method, which invokes an associated block <span class="emph">N</span> times:</p>

  <table class="processedcode">
    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">3.times { print <em class="string">"Ho! "</em> } <em class="comment">#=&gt; Ho! Ho! Ho!</em></code></td>
    </tr>
  </table>

  <p id="N11648">The <code class="cf ic">&amp;</code> prefix operator will allow a method to capture a passed block as a named parameter.</p>

  <table class="processedcode">
    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1"><strong class="prompt">def</strong> wrap &amp;b</code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">print <em class="string">"Santa says: "</em></code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">3.times(&amp;b)</code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">print <em class="string">"</em>\n<em class="string">"</em></code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1"><strong class="prompt">end</strong></code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">wrap { print <em class="string">"Ho! "</em> }</code></td>
    </tr>
  </table>

  <p id="N11679">Within a block, or a method, control is sequential except when there is an exception.</p>

  <h3 id="wtf.raise">Exceptions</h3>

  <p id="N11688">Exceptions are objects (of class <code class="cf class">Exception</code> or its subclasses). The <code class="cf ic">raise</code> method causes an exception to be raised. This interrupts the normal flow through the code. Instead, Ruby searches back through the call stack for code that says it can handle this exception.</p>

  <p id="wtf.rescue">Both methods and blocks of code wrapped between <code class="cf ic">begin</code> and <code class="cf ic">end</code> keywords intercept certain classes of exceptions using <code class="cf ic">rescue</code> clauses.</p>

  <table class="processedcode">
    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1"><strong class="prompt">begin</strong></code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">content = load_blog_data(file_name)</code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1"><strong class="prompt">rescue</strong> BlogDataNotFound</code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">STDERR.puts <em class="string">"File</em> #{file_name} <em class="string">not found"</em></code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1"><strong class="prompt">rescue</strong> BlogDataFormatError</code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">STDERR.puts <em class="string">"Invalid blog data in</em> #{file_name}<em class="string">"</em></code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1"><strong class="prompt">rescue</strong> Exception =&gt; exc</code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1">STDERR.puts <em class="string">"General error loading</em> #{file_name}<em class="string">:</em> #{exc.message}<em class="string">"</em></code></td>
    </tr>

    <tr>
      <td class="codeprefix">&nbsp;</td>

      <td class="codeline"><code class="sgc-1"><strong class="prompt">end</strong></code></td>
    </tr>
  </table>

  <p id="N116FD"><code class="cf ic">rescue</code> clauses can be directly placed on the outermost level of a method definition without needing to enclose the contents in a <code class="cf ic">begin</code>/<code class="cf ic">end</code> block.</p>

  <p id="N11708">That concludes our brief introduction to control flow, and at this point we have our basic building blocks upon which we can build larger structures.</p><script src="../Misc/book_local.js" type="text/javascript">
</script>
</body>
</html>
